<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Guide · VP4Optim.jl</title><meta name="title" content="Guide · VP4Optim.jl"/><meta property="og:title" content="Guide · VP4Optim.jl"/><meta property="twitter:title" content="Guide · VP4Optim.jl"/><meta name="description" content="Documentation for VP4Optim.jl."/><meta property="og:description" content="Documentation for VP4Optim.jl."/><meta property="twitter:description" content="Documentation for VP4Optim.jl."/><meta property="og:url" content="https://cganter.github.io/VP4Optim.jl/man/guide/"/><meta property="twitter:url" content="https://cganter.github.io/VP4Optim.jl/man/guide/"/><link rel="canonical" href="https://cganter.github.io/VP4Optim.jl/man/guide/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">VP4Optim.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../example/">Example</a></li><li class="is-active"><a class="tocitem" href>Guide</a><ul class="internal"><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Model-definition"><span>Model definition</span></a></li><li><a class="tocitem" href="#Constructor-parameters"><span>Constructor parameters</span></a></li><li><a class="tocitem" href="#Constructor"><span>Constructor</span></a></li><li><a class="tocitem" href="#Model-parameters"><span>Model parameters</span></a></li><li><a class="tocitem" href="#VARPRO-routines"><span>VARPRO routines</span></a></li><li><a class="tocitem" href="#Interface-for-[Optim.jl](https://github.com/JuliaNLSolvers/Optim.jl)"><span>Interface for Optim.jl</span></a></li><li><a class="tocitem" href="#Model-specific"><span>Model specific</span></a></li><li><a class="tocitem" href="#Model-testing"><span>Model testing</span></a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Guide</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Guide</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/cganter/VP4Optim.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/cganter/VP4Optim.jl/blob/main/docs/src/man/guide.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Guide"><a class="docs-heading-anchor" href="#Guide">Guide</a><a id="Guide-1"></a><a class="docs-heading-anchor-permalink" href="#Guide" title="Permalink"></a></h1><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p>The package can be installed with the Julia package manager. From the Julia REPL, type <code>]</code> to enter the Pkg REPL mode and run</p><pre><code class="nohighlight hljs">pkg&gt; add VP4Optim</code></pre><h2 id="Model-definition"><a class="docs-heading-anchor" href="#Model-definition">Model definition</a><a id="Model-definition-1"></a><a class="docs-heading-anchor-permalink" href="#Model-definition" title="Permalink"></a></h2><p>VARPRO can be applied to any data model that can be written in the form  <span>$\bm{y}\approx \bm{A}\,\bm{c}$</span>. Apparently, the nontrivial part of the model definition depends on how  the matrix <span>$\bm{A}\left(\bm{p}\right)$</span> is actually defined as a function of tunable parameters <span>$\bm{p}$</span>.  With respect to optimization though, we sometimes may only want some subset <span>$\bm{x}\subseteq\bm{p}$</span>  to be variable while keeping the rest fixed<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>. In addition, we want to remain flexible with respect to  selecting different subsets of <span>$\bm{p}$</span> as variable. </p><p>To address these requirements, any specific VARPRO model in  <a href="https://github.com/cganter/VP4Optim.jl">VP4Optim</a> shall be defined as some subtype of the abstract type <code>VP4Optim.Model{Ny,Nx,Nc,T}</code></p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.Model" href="#VP4Optim.Model"><code>VP4Optim.Model</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Model{Ny,Nx,Nc,T}</code></pre><p>Abstract supertype of any model specification.</p><p><strong>Type parameters</strong></p><ul><li><code>Ny::Int</code>: length of data vector <code>y</code>.</li><li><code>Nx::Int</code>: number of <em>variable</em> parameters.</li><li><code>Nc::Int</code>: number of linear coefficients.</li><li><code>T &lt;: Union{Float64, ComplexF64}</code> is equal to <code>eltype(y)</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L7-L17">source</a></section></article><p>Some fields are mandatory in any model definition, as shown in the following example of a complex valued model<sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup>:</p><pre><code class="language-julia hljs">import VP4Optim as VP
using StaticArrays

mutable struct SpecificModel{Ny,Nx,Nc} &lt;: VP.Model{Ny,Nx,Nc,ComplexF64}
    # mandatory fields of any Model instance

    # names of all parameters, variable and fixed 
    # Example: sym == [:a, :b, :c, :d, :e]
    
    sym::Vector{Symbol}     

    # subset of variable parameter names
    # Example: x_sym == [:d, :a, :c] (order defined by x_ind below)
    # Note that this also implies Nx == 3
    
    x_sym::Vector{Symbol}   
    
    # complementary subset of fixed parameter names
    # Example: par_sym == [:e, :b] (order defined by par_ind below)
    
    par_sym::Vector{Symbol} 
    
    # values of all parameters in the order specified by sym
    # Example: val == [a, b, c, d, e]
    
    val::Vector{Float64}
    
    # indices of variable parameters in field val
    # Example: x_ind == SVector{Nx}([4, 1, 3]) (according to the definition of x_sym above)
    # such that
    # x_sym[1] == sym[x_ind[1]] == sym[4] == :d
    # val[x_ind[1]] == val[4] == d
    # x_sym[2] == sym[x_ind[2]] == sym[1] == :a
    # val[x_ind[2]] == val[1] == a
    # x_sym[3] == sym[x_ind[3]] == sym[3] == :c
    # val[x_ind[3]] == val[3] == c
    
    x_ind::SVector{Nx,Int}

    # indices of fixed parameters in field val
    # Example: par_ind == [5, 2] (according to the definition of par_sym above)
    # such that
    # par_sym[1] == sym[par_ind[1]] == sym[5] == :e
    # val[par_ind[1]] == val[5] == e
    # par_sym[2] == sym[par_ind[2]] == sym[2] == :b
    # val[par_ind[2]] == val[2] == b
    
    par_ind::Vector{Int}
    
    # actual data vector
    
    y::SVector{Ny,ComplexF64}            
    
    # == real(y&#39; * y) (by default automatically calculated in generic method VP.y!())
    
    y2::Float64                 

    # optional model-specific information, needed for the constructor
    X::Float64
    Y::Symbol
    time_points::Vector{Float64}
    Z::Vector{ComplexF64}

    # and/or allocated workspace
    # ...
end</code></pre><div class="admonition is-info" id="Note-a445ccea9d289fd6"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-a445ccea9d289fd6" title="Permalink"></a></header><div class="admonition-body"><p>For general models, one can include the matrix <code>A::SMatrix{Ny, Nc}</code> as an additional field in any model implementation, since this prevents unnecessary recomputations of <code>A</code>. With this approach, one would let the methods <a href="#VP4Optim.x_changed!">x_changed!</a> and <a href="#VP4Optim.par_changed!">par_changed!</a> trigger updates of the field <code>A</code>.</p><p>For proper functioning of the package, neither field <code>A</code> or method <a href="#VP4Optim.A">A</a> are mandatory though, as long as the methods <a href="#VP4Optim.Bb!">Bb!</a>, <a href="#VP4Optim.∂Bb!">∂Bb!</a> and <a href="#VP4Optim.∂∂Bb!">∂∂Bb!</a> are implemented properly (cf. the method descriptions for more details).  Depending on the model, this route can often be preferrable to improve numerical performance.</p></div></div><h2 id="Constructor-parameters"><a class="docs-heading-anchor" href="#Constructor-parameters">Constructor parameters</a><a id="Constructor-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Constructor-parameters" title="Permalink"></a></h2><p>Depending on the model, the number of arguments for the <a href="#Constructor">Constructor</a> can be large. For this reason, we collect these arguments as fields in a subtype of</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.ModPar" href="#VP4Optim.ModPar"><code>VP4Optim.ModPar</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ModPar{T}</code></pre><p>Abstract supertype of model parameters.</p><p><strong>Remarks</strong></p><ul><li>Intended to be implemented as a non-mutable structure.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L20-L28">source</a></section></article><p>For the example model above, the definition could look like</p><pre><code class="language-julia hljs">struct SpeModPar &lt;: VP.ModPar{SpecificModel}
    sym::Vector{Symbol}
    x_sym::Vector{Symbol}
    X::Float64
    Y::Symbol
    time_points::Vector{Float64}
end</code></pre><div class="admonition is-info" id="Note-7e790c68f07f4716"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-7e790c68f07f4716" title="Permalink"></a></header><div class="admonition-body"><p>Instances of <code>ModPar</code> are only used as arguments for the <a href="#Constructor">Constructor</a>.</p><p>Internal parameters, like <code>a,b,c,d,e</code> in the example above, are typically set via <a href="#VP4Optim.par!-Tuple{VP4Optim.Model, AbstractArray, AbstractArray}">par!</a> or <a href="#VP4Optim.x">x!</a> and therefore usually <em>not</em> included in subtypes of <code>ModPar</code>.</p></div></div><p>For <a href="#VP4Optim.modpar">modpar</a> to work, any subtype of <code>ModPar</code> should provide a default constructor without arguments</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.ModPar-Tuple{Type{&lt;:VP4Optim.Model}}" href="#VP4Optim.ModPar-Tuple{Type{&lt;:VP4Optim.Model}}"><code>VP4Optim.ModPar</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ModPar(::Type{&lt;: Model})</code></pre><p>Construct default parameters for model of type <code>T</code>.</p><p><strong>Remark</strong></p><ul><li>Must be implemented for each specific model.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L31-L38">source</a></section></article><p>like this</p><pre><code class="language-julia hljs">function VP.ModPar(::Type{SpecificModel})
    sym_ = [:a, :b, :c, :d, :e]
    x_sym_ = deepcopy(sym)
    X_ = 0.0
    Y_ = :42
    time_points_ = Float64[]
    
    SpeModPar(sym_, x_sym_, X_, Y_, time_points_)
end</code></pre><div class="admonition is-info" id="Note-973404c87e7e502e"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-973404c87e7e502e" title="Permalink"></a></header><div class="admonition-body"><p>There is no need to define <code>ModPar</code> mutable, since the <a href="#VP4Optim.modpar">modpar</a> routines are supplied.</p></div></div><p>To specify model settings, the <a href="#VP4Optim.modpar">modpar</a> routines can be used </p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.modpar" href="#VP4Optim.modpar"><code>VP4Optim.modpar</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">modpar(T::Type{&lt;: Model}; kwargs...)</code></pre><p><strong>Arguments</strong></p><ul><li><code>T::Type{&lt;: Model}</code>: Type of the model to be constructed.</li><li><code>kwargs</code>: Arbitrary number of keyword arguments.</li></ul><p><strong>Returns</strong></p><ul><li>Instance of type <code>&lt;: ModPar{T}</code>.</li></ul><p><strong>Remarks</strong></p><ul><li>First generates default parameters with <a href="#VP4Optim.ModPar-Tuple{Type{&lt;:VP4Optim.Model}}">ModPar</a> (which must be implemented for each model)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L41-L51">source</a></section><section><div><pre><code class="language-julia hljs">modpar(mp::ModPar{T}; kwargs...) where {T &lt;: Model}</code></pre><p><strong>Arguments</strong></p><ul><li><code>mp::ModPar{T}</code>: Existing model parameters to be changed.</li><li><code>kwargs</code>: Arbitrary number of keyword arguments.</li></ul><p><strong>Returns</strong></p><ul><li>Instance of type <code>&lt;: ModPar{T}</code>.</li></ul><p><strong>Remarks</strong></p><ul><li>Note that the argument <code>mp</code> is <em>not</em> modified.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L59-L69">source</a></section></article><p>which are applied like this</p><pre><code class="language-julia hljs"># Generate an instance of ModPar either with default settings ...
smp = modpar(SpecificModel)  # equivalent to smp = VP.ModPar(SpecificModel)
# ... or specific settings via one or more keyword arguments
smp = modpar(SpecificModel; x_sym = [:a, :d], Y_ = :43)

# Parameters of an instance smp can also be changed
smp = modpar(smp; x_sym = [:a, :b, :c], X_ = 1.0, time_points_ = [0, 1, 2])</code></pre><div class="admonition is-info" id="Note-b4e867af007a5082"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-b4e867af007a5082" title="Permalink"></a></header><div class="admonition-body"><ul><li><a href="#VP4Optim.modpar">modpar</a> does not change the supplied argument <code>smp</code> but returns a new one, which must be caught.</li></ul></div></div><h2 id="Constructor"><a class="docs-heading-anchor" href="#Constructor">Constructor</a><a id="Constructor-1"></a><a class="docs-heading-anchor-permalink" href="#Constructor" title="Permalink"></a></h2><p>For given model parameters, a model instance can always be generated with the function</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.create_model" href="#VP4Optim.create_model"><code>VP4Optim.create_model</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">create_model(mp::ModPar{T}) where {T &lt;: Model}</code></pre><p>Create a new instance of model <code>T</code> with model parameters <code>mp</code></p><p><strong>Remarks</strong></p><ul><li>Calls <a href="#VP4Optim.check">check</a> to guarantee consistency of parameters.</li><li>Then calls the constructor <code>T(mp)</code>, which must be implemented for each model.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L76-L84">source</a></section></article><p>like this</p><pre><code class="language-julia hljs"># Generate an instance of SpecificModel
mod = VP.create_model(smp)</code></pre><div class="admonition is-info" id="Note-a42350d988df8087"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-a42350d988df8087" title="Permalink"></a></header><div class="admonition-body"><ul><li><p>For this to work, each model <code>SpecificModel</code> must provide a constuctor <code>SpecificModel(::SpeModPar)</code>.</p></li><li><p>To benefit from the increased performance of <a href="https://github.com/JuliaArrays/StaticArrays.jl">StaticArrays.jl</a>, the parameters <code>Ny</code>, <code>Nx</code>, <code>Nc</code> need to be known at <em>compile time</em>. This can be accomplished with the following exemplary setup:</p></li></ul></div></div><pre><code class="language-julia hljs">function SpecificModel(smp::SpeModPar)
    # Number of variable parameters
    Nx = length(smp.x_sym)

    # In our example, the number of data points must be equal to the number of time points:
    Ny = length(smp.time_points)

    # If not already fixed by SpecificModel, Nc must also be inferred from smp:
    Nc = some_function_of(smp)

    # Now we can call a constructor, where Ny, Nx, Nc are converted into types
    SpecificModel(Val(Ny), Val(Nx), Val(Nc), smp)
end

function SpecificModel(::Val{Ny}, ::Val{Nx}, ::Val{Nc}, smp) where {Ny, Nx, Nc}
    # name the parameters as desired
    sym = deepcopy(smp.sym)
    
    # specify the variable subset of the parameters
    x_sym = deepcopy(smp.x_sym)
    
    # The remaining mandatory fields can be calculated as follows
    val = zeros(length(sym))
    x_ind = SVector{Nx,Int}(findfirst(x -&gt; x == x_sym[i], sym) for i in 1:Nx)
    par_ind = filter(x -&gt; x ∉ x_ind, 1:length(sym))
    par_sym = sym[par_ind]
    y = SVector{Ny,ComplexF64}(zeros(ComplexF64, Ny))
    y2 = 0.0
    
    # Optionally, initialize further fields, which appear in SpecificModel
    X = smp.X
    Y = smp.Y
    ts = deepcopy(smp.time_points)
    Z = exp.(im * smp.X * ts)

    # Finally, generate an instance of SpecificModel with the default constructor
    SpecificModel{Ny, Nx, Nc}(sym, x_sym, par_sym, val, x_ind, par_ind, y, y2, X, Y, Z, ts)
end</code></pre><div class="admonition is-info" id="Note-e21948645dcc6718"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-e21948645dcc6718" title="Permalink"></a></header><div class="admonition-body"><p>Often, the number of linear coefficients <code>Nc</code> is already determined by the <code>SpecificModel</code> type.  In such cases, <code>Nc</code> will not appear as a type parameter. </p><p>An example is the biexponential (<code>Nc == 2</code>) decay model in <a href="https://github.com/cganter/VP4Optim.jl/blob/main/test/BiExpDecay.jl">BiExpDecay.jl</a></p><pre><code class="language-julia hljs">mutable struct BiExpDecay{Ny, Nx} &lt;: VP.Model{Ny, Nx, 2, ComplexF64}
...
end</code></pre><p>Also the constructors will then need to be adapted accordingly, as  shown there.</p></div></div><div class="admonition is-info" id="Note-32f08c2806046fcb"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-32f08c2806046fcb" title="Permalink"></a></header><div class="admonition-body"><ul><li>The method <a href="#VP4Optim.create_model">create_model</a> calls the function <a href="#VP4Optim.check">check</a> before actually calling the constructor.</li><li>If model parameters have to fulfil certain requirements, these model-dependent constistency checks should therefore be placed in <a href="#VP4Optim.check">check</a>:</li></ul></div></div><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.check" href="#VP4Optim.check"><code>VP4Optim.check</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">check(::ModPar)</code></pre><p>Throws an Exception, if the supplied constructor parameters are inconsistent.</p><p><strong>Arguments</strong></p><ul><li><code>::ModPar</code>: Instance of model parameters to be checked.</li></ul><p><strong>Default</strong></p><ul><li>Does nothing.</li></ul><p><strong>Remarks</strong></p><ul><li>Is automatically called by <a href="#VP4Optim.create_model">create_model</a>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L90-L101">source</a></section></article><p>In our case, an implementation of <a href="#VP4Optim.check">check</a> could looks like this</p><pre><code class="language-julia hljs">function check(smp::SpeModPar)
    @assert length(smp.sym) == 5
    @assert all(sy -&gt; sy ∈ smp.sym, smp.x_sym)
    @assert smp.X ≥ 0
    # ...
end</code></pre><h2 id="Model-parameters"><a class="docs-heading-anchor" href="#Model-parameters">Model parameters</a><a id="Model-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Model-parameters" title="Permalink"></a></h2><p>Based upon the mandatory fields in any <code>Model</code> instance, the following routines allow access and (partly) modify the fields (after initialization in the constructor).</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.N_data" href="#VP4Optim.N_data"><code>VP4Optim.N_data</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">N_data(::Model{Ny,Nx,Nc,T}) where {Ny,Nx,Nc,T}</code></pre><p>Returns <code>Ny</code> (number of data)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L104-L108">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.N_var" href="#VP4Optim.N_var"><code>VP4Optim.N_var</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">N_var(::Model{Ny,Nx,Nc,T}) where {Ny,Nx,Nc,T}</code></pre><p>Returns <code>Nx</code> (number of variable parameters)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L113-L117">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.N_coeff" href="#VP4Optim.N_coeff"><code>VP4Optim.N_coeff</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">N_coeff(::Model{Ny,Nx,Nc,T}) where {Ny,Nx,Nc,T}</code></pre><p>Returns <code>Nc</code> (number of linear coefficients)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L122-L126">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.data_type" href="#VP4Optim.data_type"><code>VP4Optim.data_type</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">data_type(::Model{Ny,Nx,Nc,T}) where {Ny,Nx,Nc,T}</code></pre><p>Returns <code>T</code> (data type of model)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L131-L135">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.sym" href="#VP4Optim.sym"><code>VP4Optim.sym</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">sym(mod::Model)</code></pre><p>Return <em>all</em> model parameter names (type: <code>Symbol</code>), variable and fixed.</p><p><strong>Default</strong></p><ul><li>Returns <code>mod.sym::Vector{Symbol}</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L140-L148">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.val" href="#VP4Optim.val"><code>VP4Optim.val</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">val(mod::Model)</code></pre><p>Returns <em>all</em> model parameters.</p><p><strong>Default</strong></p><ul><li>Returns <code>mod.val::Vector{Float64}</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L179-L187">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.x_sym" href="#VP4Optim.x_sym"><code>VP4Optim.x_sym</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">x_sym(mod::Model)</code></pre><p>Return <em>variable</em> model parameter names.</p><p><strong>Default</strong></p><ul><li>Returns <code>mod.x_sym::Vector{Symbol}</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L153-L161">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.x" href="#VP4Optim.x"><code>VP4Optim.x</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">x(mod::Model)</code></pre><p>Returns <em>variable</em> model parameters, according to the order specified in <code>mod.x_ind</code>.</p><p><strong>Default</strong></p><ul><li>Returns <code>mod.val[mod.x_ind]::Vector{Float64}</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L192-L200">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.x!-Tuple{VP4Optim.Model, AbstractArray, AbstractArray}" href="#VP4Optim.x!-Tuple{VP4Optim.Model, AbstractArray, AbstractArray}"><code>VP4Optim.x!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">x!(mod::Model, x_syms::AbstractArray, x_vals::AbstractArray)</code></pre><p>Resets those variable parameters, which are specified in <code>x_syms</code>, by the values in <code>x_vals</code>.</p><p><strong>Default</strong></p><ul><li>Copies the values from <code>x_vals</code> into the associated locations.</li><li>Subsequently calls <a href="#VP4Optim.x_changed!">x_changed!</a> to trigger optional secondary actions.</li><li>Returns <code>nothing</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L218-L229">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.x!-Tuple{VP4Optim.Model, AbstractArray}" href="#VP4Optim.x!-Tuple{VP4Optim.Model, AbstractArray}"><code>VP4Optim.x!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">x!(mod::Model, new_x::AbstractArray)</code></pre><p>Resets <em>all</em> variable parameters by the values in <code>new_x</code>.</p><p><strong>Default</strong></p><ul><li>Copies the values from <code>new_x</code> into <code>val[x_ind]</code> (in this order).</li><li>Subsequently calls <a href="#VP4Optim.x_changed!">x_changed!</a> to trigger optional secondary actions.</li><li>Returns <code>nothing</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L239-L249">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.par_sym" href="#VP4Optim.par_sym"><code>VP4Optim.par_sym</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">par_sym(mod::Model)</code></pre><p>Returns <em>fixed</em> model parameter names.</p><p><strong>Default</strong></p><ul><li>Returns <code>mod.par_sym::Vector{Symbol}</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L166-L174">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.par" href="#VP4Optim.par"><code>VP4Optim.par</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">par(mod::Model)</code></pre><p>Returns <em>fixed</em> model parameters, according to the order specified in <code>mod.par_ind</code>.</p><p><strong>Default</strong></p><ul><li>Returns <code>mod.val[mod.par_ind]::Vector{Float64}</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L205-L213">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.par!-Tuple{VP4Optim.Model, AbstractArray, AbstractArray}" href="#VP4Optim.par!-Tuple{VP4Optim.Model, AbstractArray, AbstractArray}"><code>VP4Optim.par!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">par!(mod::Model, p_syms::AbstractArray, p_vals::AbstractArray)</code></pre><p>Resets those fixed parameters, which are specified in <code>par_syms</code>, by the values in <code>p_vals</code>.</p><p><strong>Default</strong></p><ul><li>Copies the values from <code>p_vals</code> into the associated locations.</li><li>Subsequently calls <a href="#VP4Optim.par_changed!">par_changed!</a> to trigger optional secondary actions.</li><li>Returns <code>nothing</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L256-L267">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.par!-Tuple{VP4Optim.Model, AbstractArray}" href="#VP4Optim.par!-Tuple{VP4Optim.Model, AbstractArray}"><code>VP4Optim.par!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">par!(mod::Model, new_par::AbstractArray)</code></pre><p>Resets <em>all</em> fixed parameters by the values in <code>new_par</code>.</p><p><strong>Default</strong></p><ul><li>Copies the values from <code>new_par</code> into <code>val[par_ind]</code> (in this order).</li><li>Subsequently calls <a href="#VP4Optim.par_changed!">par_changed!</a> to trigger optional secondary actions.</li><li>Returns <code>nothing</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L277-L287">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.y" href="#VP4Optim.y"><code>VP4Optim.y</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">y(mod::Model)</code></pre><p>Returns the actual data vector.</p><p><strong>Default</strong></p><ul><li>Returns <code>mod.y::SVector{Ny, T}</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L324-L332">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.y!" href="#VP4Optim.y!"><code>VP4Optim.y!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">y!(mod::Model{Ny,Nx,Nc,T}, new_y::AbstractArray) where {Ny,Nx,Nc,T}</code></pre><p>Sets new data values.</p><p><strong>Default</strong></p><ul><li>Resets <code>mod.y::SVector{Ny, T}</code> with the content of <code>new_y</code>.</li><li>Calculates the squared magnitude of <code>mod.y</code> and stores the result in <code>mod.y2::Float64</code>.</li><li>Returns nothing.</li></ul><p><strong>Remarks</strong></p><ul><li>In most cases, it is safer to call <a href="#VP4Optim.set_data!">set_data!</a> instead of <a href="#VP4Optim.y!">y!</a>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L337-L351">source</a></section></article><div class="admonition is-info" id="Note-e99a08fc093af8f6"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-e99a08fc093af8f6" title="Permalink"></a></header><div class="admonition-body"><ul><li>Changing the data does <em>not</em> require to generate a new model instance!</li><li>To be on the safe side, use <a href="#VP4Optim.set_data!">set_data!</a> instead of <a href="#VP4Optim.y">y!</a>.</li></ul></div></div><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.set_data!" href="#VP4Optim.set_data!"><code>VP4Optim.set_data!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">set_data!(mod::Model, new_data::AbstractArray)</code></pre><p>Sets new data values safely.</p><p><strong>Default</strong></p><ul><li>Simply calls <a href="#VP4Optim.y!">y!</a>.</li></ul><p><strong>Remarks</strong></p><ul><li>Can be used to perform preprocessing of data, if required by specific models.</li><li>This is the recommended method to (re)set new data.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L358-L371">source</a></section></article><h2 id="VARPRO-routines"><a class="docs-heading-anchor" href="#VARPRO-routines">VARPRO routines</a><a id="VARPRO-routines-1"></a><a class="docs-heading-anchor-permalink" href="#VARPRO-routines" title="Permalink"></a></h2><p>These methods provide an interface to VARPRO, as described in <a href="../../#Variable-Projection">Variable Projection</a>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.A" href="#VP4Optim.A"><code>VP4Optim.A</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">A(::Model)</code></pre><p>Return VARPRO matrix <code>A</code>.</p><p><strong>Default</strong></p><ul><li>Returns <code>mod.A</code>, if the field exists and throws an error otherwise.</li></ul><p><strong>Remarks</strong></p><ul><li>Proper functioning of the method is mandatory. If the field <code>mod.A</code> does not exist, the method has to be implemented for the specific model.</li><li>Can be replaced by model-specific implementation, if the field <code>mod.A</code> does not exist.</li><li>In that scenario, the methods <a href="#VP4Optim.x_changed!">x_changed!</a> and <a href="#VP4Optim.par_changed!">par_changed!</a> trigger updates of <code>mod.A</code>.</li><li>if the models exhibit redundancy , the return type can be</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L376-L391">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.B" href="#VP4Optim.B"><code>VP4Optim.B</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">B(mod::Model)</code></pre><p>Returns matrix <code>B::SMatrix{Nc,Nc}</code></p><p><strong>Remarks</strong></p><ul><li>Returns <code>A(mod)&#39; * A(mod)</code> by default.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L400-L408">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.b" href="#VP4Optim.b"><code>VP4Optim.b</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">b(mod::Model)</code></pre><p>Returns vector <code>b::SVector{Nc}</code></p><p><strong>Remarks</strong></p><ul><li>Returns <code>A(mod)&#39; * y(mod)</code> by default.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L413-L421">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.Bb!" href="#VP4Optim.Bb!"><code>VP4Optim.Bb!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Bb!(mod::Model)</code></pre><p>Return matrix <code>B = A&#39; * A</code> and vector <code>b = A&#39; * y</code>.</p><p><strong>Default</strong></p><ul><li>Direct calculation, based upon methods <a href="#VP4Optim.A">A</a> and <a href="#VP4Optim.y">y</a>.</li></ul><p><strong>Remarks</strong></p><ul><li>Mandatory routine for the calculation of <code>χ²</code> (and its derivatives)</li><li>Can be replaced by model-specific implementation, to improve the performance.</li><li>Expected to return <code>(B, b)::Tuple</code>.</li><li>For general models, the return types could be <code>B::SMatrix{Nc,Nc,T}</code> and <code>b::SVector{Nc,T}</code></li><li>In most cases, model-specific implementations will be more efficient though.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L444-L460">source</a></section></article><div class="admonition is-info" id="Note-b7a84a16e10999c9"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-b7a84a16e10999c9" title="Permalink"></a></header><div class="admonition-body"><p>As long as <code>y^2 - b&#39; * (B \ b)</code> gives the correct result (<code>χ2</code>), everything should be fine.<br/>The same is true for the partial derivatives.</p><p>In case of doubt, look at how  <a href="#VP4Optim.f-Tuple{VP4Optim.Model}">f</a>, <a href="#VP4Optim.fg!-Tuple{VP4Optim.Model}">fg!</a> and <a href="#VP4Optim.fgh!-Tuple{VP4Optim.Model}">fgh!</a> are  implemented in the source code.</p></div></div><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.c" href="#VP4Optim.c"><code>VP4Optim.c</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">c(mod::Model)</code></pre><p>Return VARPRO vector <code>c</code>.</p><p><strong>Default</strong></p><ul><li>Gets <code>B</code> and <code>b</code> from <a href="#VP4Optim.Bb!">Bb!</a> and calculates generic solution <code>c = B \ b</code>.</li></ul><p><strong>Remarks</strong></p><ul><li>Can be replaced by model-specific implementation, if desired (e.g. for performance improvements).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L426-L438">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.y_model" href="#VP4Optim.y_model"><code>VP4Optim.y_model</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">y_model(mod::Model)</code></pre><p>Compute model prediction <code>A(x) * c</code>.</p><p><strong>Default</strong></p><ul><li>Calculates the product of the methods <a href="#VP4Optim.A">A</a> and <a href="#VP4Optim.c">c</a></li></ul><p><strong>Remarks</strong></p><ul><li>Return type <code>== SVector{Ny,T}</code></li><li>Can be used to check the model or generate synthetic data.</li><li>If necessary, a model-specific implementation may be needed. (e.g., if the method <a href="#VP4Optim.A">A</a> has not be implemented.)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L510-L524">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.χ2" href="#VP4Optim.χ2"><code>VP4Optim.χ2</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">χ2(mod::Model)</code></pre><p>Return <code>χ² = y² - b&#39; * (B \ b)</code> of actual model.</p><p><strong>Default</strong></p><ul><li>Uses <code>mod.y2</code> and <code>(B, b)</code> from <a href="#VP4Optim.Bb!">Bb!</a> to directly calculate the expression.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L529-L537">source</a></section></article><h2 id="Interface-for-[Optim.jl](https://github.com/JuliaNLSolvers/Optim.jl)"><a class="docs-heading-anchor" href="#Interface-for-[Optim.jl](https://github.com/JuliaNLSolvers/Optim.jl)">Interface for <a href="https://github.com/JuliaNLSolvers/Optim.jl">Optim.jl</a></a><a id="Interface-for-[Optim.jl](https://github.com/JuliaNLSolvers/Optim.jl)-1"></a><a class="docs-heading-anchor-permalink" href="#Interface-for-[Optim.jl](https://github.com/JuliaNLSolvers/Optim.jl)" title="Permalink"></a></h2><p>Numerical minimization can be facilitated by the use of powerful optimization libraries, such as <a href="https://github.com/JuliaNLSolvers/Optim.jl">Optim.jl</a>. To this end,  <a href="https://github.com/cganter/VP4Optim.jl">VP4Optim</a> provides some convenience functions, which  provide interfaces to <span>$χ²$</span> and its partial derivatives (up to second order) in a form as  typically expected by the optimization libraries. Also a Hessian-based preconditioner is available.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.f-Tuple{VP4Optim.Model}" href="#VP4Optim.f-Tuple{VP4Optim.Model}"><code>VP4Optim.f</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">f(mod::Model)</code></pre><p>Return function <code>f</code> of argument <code>x</code> to be minimized, as expected by Optim.jl</p><p><strong>Remark</strong></p><ul><li>Returns anonymous function <code>x -&gt; ...</code> (cf. <a href="https://github.com/JuliaNLSolvers/Optim.jl">Optim.jl</a>)</li><li>Depends on <a href="#VP4Optim.Bb!">Bb!</a>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L543-L552">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.fg!-Tuple{VP4Optim.Model}" href="#VP4Optim.fg!-Tuple{VP4Optim.Model}"><code>VP4Optim.fg!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">fg!(mod::Model)</code></pre><p>Return function <code>fg!</code> of three arguments <code>(F, G, x)</code> as expected by Optim.jl.</p><p><strong>Remark</strong></p><ul><li>Returns anonymous function <code>(F, G, x) -&gt; ...</code> (cf. <a href="https://github.com/JuliaNLSolvers/Optim.jl">Optim.jl</a>)</li><li>Depends on <a href="#VP4Optim.Bb!">Bb!</a> and <a href="#VP4Optim.∂Bb!">∂Bb!</a>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L561-L570">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.fgh!-Tuple{VP4Optim.Model}" href="#VP4Optim.fgh!-Tuple{VP4Optim.Model}"><code>VP4Optim.fgh!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">fgh!(mod::Model)</code></pre><p>Return function <code>fgh!</code> of four arguments <code>(F, G, H, x)</code> as expected by Optim.jl.</p><p><strong>Remark</strong></p><ul><li>Returns anonymous function <code>(F, G, H, x) -&gt; ...</code> (cf. <a href="https://github.com/JuliaNLSolvers/Optim.jl">Optim.jl</a>)</li><li>Depends on <a href="#VP4Optim.Bb!">Bb!</a>, <a href="#VP4Optim.∂Bb!">∂Bb!</a> and <a href="#VP4Optim.∂∂Bb!">∂∂Bb!</a>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L586-L595">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.P" href="#VP4Optim.P"><code>VP4Optim.P</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">P(mod::Model{Ny,Nx,Nc,T}, x) where {Ny,Nx,Nc,T}</code></pre><p>Returns Hessian of <span>$χ²(x)$</span>.</p><p><strong>Remark</strong></p><ul><li>Can be used as preconditioner, as expected by <a href="https://github.com/JuliaNLSolvers/Optim.jl">Optim.jl</a>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L614-L622">source</a></section></article><h2 id="Model-specific"><a class="docs-heading-anchor" href="#Model-specific">Model specific</a><a id="Model-specific-1"></a><a class="docs-heading-anchor-permalink" href="#Model-specific" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.x_changed!" href="#VP4Optim.x_changed!"><code>VP4Optim.x_changed!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">x_changed!(::Model)</code></pre><p>Informs user-defined model that <code>x</code> has changed.</p><p><strong>Default</strong></p><ul><li>Does nothing.</li></ul><p><strong>Remarks</strong></p><ul><li>Can be used to recalculate any auxiliary model variable (such as <code>A</code>), which depends on <code>x</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L294-L306">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.par_changed!" href="#VP4Optim.par_changed!"><code>VP4Optim.par_changed!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">par_changed!(::Model)</code></pre><p>Informs user-defined model that <code>par</code> has changed.</p><p><strong>Default</strong></p><ul><li>Does nothing.</li></ul><p><strong>Remarks</strong></p><ul><li>Can be used to recalculate any auxiliary model variable (such as <code>A</code>), which depends on <code>par</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L309-L321">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.∂Bb!" href="#VP4Optim.∂Bb!"><code>VP4Optim.∂Bb!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">∂Bb!(::Model)</code></pre><p>Returns up to first order partial derivatives with respect to <code>x</code>.</p><p><strong>Default</strong></p><ul><li>None, must be supplied by the user.</li></ul><p><strong>Remarks</strong></p><ul><li>Required for first and second order optimization techniques.</li><li>Returns <code>(B, b, ∂B, ∂b)::Tuple</code></li><li><code>(B, b)</code> as returned from <a href="#VP4Optim.Bb!">Bb!</a></li><li>Types: <code>∂B::SVector{Nx, SMatrix{Nc,Nc,T}}</code> and <code>∂b::SVector{Nx, SVector{Nc,T}}</code></li><li>(or anything, which works with the implementation of <a href="#VP4Optim.fg!-Tuple{VP4Optim.Model}">fg!</a> and <a href="#VP4Optim.fgh!-Tuple{VP4Optim.Model}">fgh!</a>)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L468-L484">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.∂∂Bb!" href="#VP4Optim.∂∂Bb!"><code>VP4Optim.∂∂Bb!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">∂∂Bb!(::Model)</code></pre><p>Returns up to second order partial derivatives with respect to <code>x</code></p><p><strong>Default</strong></p><ul><li>None, must be supplied by the user.</li></ul><p><strong>Remarks</strong></p><ul><li>Required for second order optimization techniques.</li><li>Returns <code>(B, b, ∂B, ∂b, ∂∂B, ∂∂b)::Tuple</code></li><li><code>(B, b, ∂B, ∂b)</code> as returned from <a href="#VP4Optim.∂Bb!">∂Bb!</a></li><li>Types: <code>∂∂B::SMatrix{Nx, Nx, SMatrix{Nc,Nc,T}}</code> and <code>∂∂b::SMatrix{Nx, Nx, SVector{Nc,T}}</code></li><li>(or anything, which works with the implementation of <a href="#VP4Optim.fgh!-Tuple{VP4Optim.Model}">fgh!</a>)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/vp4optim_src.jl#L489-L505">source</a></section></article><h2 id="Model-testing"><a class="docs-heading-anchor" href="#Model-testing">Model testing</a><a id="Model-testing-1"></a><a class="docs-heading-anchor-permalink" href="#Model-testing" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="VP4Optim.check_model" href="#VP4Optim.check_model"><code>VP4Optim.check_model</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">check_model(pars, vals, c_, data_;
what=(:consistency, :derivatives, :optimization),
small=sqrt(eps()),
x0=[], lx=[], ux=[], x_scale=[],
precon=true,
visual=false,
rng=MersenneTwister(),
Hessian=true,
log10_rng=range(-6, -3, 10),
min_slope=0.9)</code></pre><p>Tests, which any specific model should pass.</p><p><strong>Arguments</strong></p><ul><li><code>pars::ModPar{T}</code>: Model parameters for constructor <code>create_model(pars)</code>.</li><li><code>vals::Vector{Float64}</code>: <em>All</em> nonlinear parameters, the model depends on. As defined in the <code>Model</code> field <code>val</code>.</li><li><code>c_::Vector{Nc, T}</code>: Linear cofficients, the model depends on.</li><li><code>data_::AbstractArray</code>: Data, corresponding to the <em>true</em> parameters <code>vals</code> and <code>c_</code>, in a format suitable for <code>set_data!</code>.</li><li><code>what::Tuple{Symbol}</code>: Tests to be performed (see below).</li><li><code>small::Float64</code>: Required as accuracy criterion.</li><li><code>x0::Vector{Float64}</code>: Starting point for optimization and location, where derivatives are tested.</li><li><code>lx::Vector{Float64}</code>: Lower bound of optimization</li><li><code>ux::Vector{Float64}</code>: Upper bound of optimization</li><li><code>x_scale::Vector{Float64}</code>: Scaling vector, such that <code>δx = randn(size(x)) .* x_scale</code> becomes reasonable</li><li><code>precon::Bool</code>: Test optimization with and without preconditioner.</li><li><code>visual::Bool</code>: If <code>true</code> also generate double-logarithmic plots for the derivative tests.</li><li><code>rng::MersenneTwister</code>: Allows to pass a unique seed (e.g. <code>MersenneTwister(42)</code>) for reproducible testing.</li><li><code>Hessian::Bool</code>: Should be set to <code>false</code>, if the model does not implement second order derivatives.</li><li><code>log10_rng::AbstractVector</code>: logarithmic range for derivative testing</li><li><code>min_slope::Float64</code>: minimal derivative slope on log-log plot</li></ul><p><strong>Remark</strong></p><ul><li>Tests are performed for every <code>x_sym ⊆ sym</code>.</li><li>Returns a dictionary with detailed information about the test results.</li><li><code>:consistency ∈ what</code>: Several basic tests (parameters, names, correct model values)</li><li><code>:derivatives ∈ what</code>: Check first and second order partial derivatives at <code>x0</code>.</li><li><code>:optimization ∈ what</code>: Minimize model with <code>x0</code> as starting point and bounds <code>lx</code> and <code>ux</code>.</li><li>An example application can be found in <a href="https://github.com/cganter/VP4Optim.jl/blob/main/test/test_BiExpDecay.jl"><code>test_BiExpDecay.jl</code></a>. This should also work as a template, how to perform tests on own models.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/cganter/VP4Optim.jl/blob/018f680f5734316c628773eef6ee247b21f87235/src/test_tools.jl#L4-L44">source</a></section></article><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>In <a href="../../#Variable-Projection">Variable Projection</a>, <span>$\bm{x}$</span> referred to this <em>variable</em> part only, while any fixed parameters were absorbed in the actual definition of the matrix <span>$\bm{A}$</span>.</li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>Here, we assume a fixed data type for the specific model.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../example/">« Example</a><a class="docs-footer-nextpage" href="../api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Sunday 24 August 2025 06:45">Sunday 24 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
